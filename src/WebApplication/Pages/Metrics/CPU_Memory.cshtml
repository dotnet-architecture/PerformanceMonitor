@page
@model WebApplication.Pages.Metrics.CPU_MemoryModel
@using DataTransfer;
@{
    ViewData["Title"] = "CPU_Memory";
}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-1.2.0.min.js"></script>
    <!--<meta http-equiv="refresh" content="15;url="CPU_Memory.cshtml">-->
</head>

<body>
    <div class="main">

        <font size="50">CPU and Memory Usage</font>

        <div id="chart"></div>
        <script>

            function getData() {
                return @Model.cpu[Model.cpu.Count - 1].usage;
            }

            Plotly.plot('chart', [{
                y: [getData()],
                type:'line'
            }])

            var cnt = 0;
            setInterval(function () {
                Plotly.extendTraces('chart', { y: [[getData()]] }, [0]);
                cnt++;
                if (cnt > 100) {
                    Plotly.relayout('chart', {
                        xaxis: {
                            range: [cnt - 100, cnt]
                        }
                    });
                }
            }, 5);
        </script>

        <div id="cpu"></div>
        <script>

            var CPU_Usage = {
                y: @Model.getCPUUsage(),
                type: 'scatter'
            };
            
            var data = [CPU_Usage];

            var layout = {
                xaxis: {
                    visible: true,
                    title: "Time"
                },
                yaxis: {
                    visible: true, 
                    title: "CPU Usage"
                }
            }

            var graphOptions = {
                layout: layout,
            };

            Plotly.plot('test', data, graphOptions);
        </script>

        <!--
    <div id="tester"></div>
    <script>
        TESTER = document.getElementById('tester');
        Plotly.plot(TESTER, [{
            x: [1, 2, 3, 4, 5],
            y: [1, 2, 4, 8, 16]
        }], {
                margin: { t: 0 }
            });
    </script>

    <div id="cpu"></div>
    <script>
        TESTER = document.getElementById('cpu');
        var trace1 = {
            x: [1],
            y: [2],
            type: 'scatter'
        };
        var data = [trace1];
        Plotly.plot('cpu', data);
    </script>
    -->

        <p>Average CPU Usage: @Model.avgCPU</p>

        <p>Log of CPU Usage</p>
        <div class="CPU-table" max-width="600px">
            <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>CPU</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.cpu != null)
                    {
                        @for (int i = Model.cpu.Count - 1; i >= 0; i--)
                        {
                            CPU_Usage c = Model.cpu.ElementAt<CPU_Usage>(i);
                            <tr>
                                <td>@c.usage</td>
                                <td>@c.timestamp</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>Unable to retrieve data</tr>

                    }
                </tbody>
            </table>
        </div>

        <p>Log of Memory Usage</p>
        <table class="table table-hover table-bordered">
            <thead>
                <tr>
                    <th>Memory</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.mem != null)
                {
                    @for (int i = Model.mem.Count - 1; i >= 0; i--)
                    {
                        Mem_Usage m = Model.mem.ElementAt<Mem_Usage>(i);
                        <tr>
                            <td>@m.usage</td>
                            <td>@m.timestamp</td>
                        </tr>

                    }
                }
                else
                {
                    <tr>Unable to retrieve data</tr>

                }
            </tbody>
        </table>

    </div>
    </body>

<!--
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <script type="text/javascript">
       google.charts.load('current', { 'packages': ['corechart'] });
       google.charts.setOnLoadCallback(drawChart);

       function drawChart() {
           var data = google.visualization.arrayToDataTable([
               ['TimeStamp', 'CPU'],
               ['2001', @Model.cpu[0].usage],
               ['2002', @Model.cpu[1].usage],
               //['2006', 660, 1120],
               //['2007', 1030, 540]
           ]);

           var options = {
               title: 'CPU Usage',
               curveType: 'function',
               legend: { position: 'bottom' }
           };

           var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

           chart.draw(data, options);
       }
        </script> -->
